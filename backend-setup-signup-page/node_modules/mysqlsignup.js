const mysql = require('mysql');
const express = require('express');
const bodyParser = require('body-parser');
const encoder = bodyParser.urlencoded();

const app = express();
const path = require('path');

//for index path
const indexPath = path.join(__dirname, '../../index.html');
  
//for using css for signup page
app.use("/assets", express.static(path.join(__dirname, '../../assets')));

//for connectng signup page with database along with query for username password
app.post("/",encoder, function(req,res){
  var username = req.body.username;
  var password = req.body.password;
  connection.query("select * from signup where user_name = ? and password = ?",[username,password] ,function(error,results,fields){
    if (results.length > 0) {
      res.redirect(indexPath);
    } else {
      res.redirect("/");
    }
    res.end();
  })
})
//when login is success
app.get("/index",function(req,res){
  res.sendFile(path.join(__dirname + '../../index.html'));
})

// Create a connection to the MySQL server
const connection = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: 'password',
  database: 'db',
});

// Connect to the MySQL server
connection.connect((err) => {
  if (err) {
    console.error('Error connecting to MySQL: ' + err.stack);
    return;
  }
  console.log('Connected to MySQL as id ' + connection.threadId);
}); 

//for connecting signup page to local host
app.get("/",function(req,res){
  res.sendFile(path.join(__dirname, '../../signup.html'));
});

//set app port
app.listen(4500);


/*to be changed*/ 
// app.get('',routes.index);               //app.get('',routes.index);    
// app.get('/signup',user.signup);        // app.get('/signup',user.signup);
// app.post('/login',user.login);         // app.post('/login',user.login);
// app.get('/home/profile');              // app.get('/home/profile');
// app.get('/login',routes.index);        // app.get('/login',routes.index);